{% extends "_layouts/base.html" %}
{% load staticfiles djangular_tags %}

{% block page_title %}Coding view{% endblock %}
{% block body_class %}project-coding-view{% endblock %}

{% block js %}
    {{ block.super }}

    <script src="{% static 'bower/angular/angular.js' %}"></script>
    <script src="{% static 'bower/angular-route/angular-route.js' %}"></script>
    <script src="{% static 'bower/angular-resource/angular-resource.js' %}"></script>
    <script src="{% static 'bower/angular-cookies/angular-cookies.js' %}"></script>
    <script src="{% static 'djangular/js/django-angular.js' %}"></script>

    <script src="{% static 'base/services.js' %}"></script>
    <script src="{% static 'base/models.js' %}"></script>
    <script src="{% static 'coding/coding.js' %}"></script>
    <script src="{% static 'coding/controllers.js' %}"></script>
    <script src="{% static 'coding/services.js' %}"></script>
    <script src="{% static 'coding/models.js' %}"></script>
{% endblock %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" type="text/less" href="{% static 'css/project/coding.less' %}">
{% endblock %}

{% block bootstrapping %}
    {{ block.super }}
    <script>
        angular.module('ng.django.urls')
                .constant('patterns', {% load_djng_urls %});

        angular.module('message_coding.coding')
                .constant('django_config', {
                    'STATIC_URL': '{% static '' %}'
                });

        angular.module('message_coding.coding.bootstrap')
                .constant('message_coding.coding.bootstrap.initial_data', {
                    project: {{ project_json|safe }},
                    task: {{ task_json|safe }},
                    selection: {{ selection_json|safe }},
                    user: {{ user_json|safe }}
                });
    </script>
{% endblock %}

{% block content %}

    <div class="container" ng-app="message_coding.coding">
        <h1>{{ task.name }}</h1>

        <p>{{ task.description }}</p>

        <div class="messages">
            <form method="post">
                {% csrf_token %}
                {% for msg in msgs %}
                    <div class="message {% if msg.has_image %}has-image{% endif %} row">
                        <div class="col-lg-8">
                            {% if msg.has_image %}
                                <img src="{{ msg.image_src|safe }}"/>
                            {% endif %}
                            <p class="text">{{ msg.text_without_image }}</p>
                        </div>
                        <div class="col-lg-4">
                            <ul class="code-groups">
                                {% for code_group in task.scheme.code_groups.all %}
                                    <li>
                                        <h4>{{ code_group.name }}</h4>
                                        <ul class="codes">
                                            {% for code in code_group.codes.all %}
                                                <li>
                                                    <label>
                                                        <input type="checkbox"
                                                               name="messages[{{ msg.pk }}]" value="{{ code.pk }}"/>
                                                        {{ code.name }}
                                                    </label>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                {% endfor %}
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>

        </div>
    </div>
{% endblock %}
